#!/bin/sh

set -eu

var=${1:-Godeps}

get_sha() {
	here="$(pwd)"
	cd "$GOPATH/src/$1"
	git rev-parse HEAD
	cd "$here"
}

get_branch() {
	here="$(pwd)"
	cd "$GOPATH/src/$1"
	branch=$(git rev-parse --abbrev-ref HEAD)
	cd "$here"
	if [ "$branch" == "HEAD" ]; then
		echo "NONE"
	else
		echo "$branch"
	fi
}

go list -f '{{join .Deps "\n"}}' | grep "\w*[.]\w*/" | while read dep ; do
	#echo "$dep $(get_sha $dep) $(get_branch $dep)"
	printf "%-50s %s %s\n" $dep $(get_sha $dep) $(get_branch $dep)
done
